#!/bin/sh
set -e

# Check if argument provided
if [ -z "$1" ]; then
    echo "Usage: $0 <branch-name> [count]"
    exit 1
fi

name="$1"
count="${2:-1}"

# Check if current branch is main
current_branch=$(git rev-parse --abbrev-ref HEAD)
if [ "$current_branch" != "main" ]; then
    echo "Error: Must be on main branch. Currently on: $current_branch"
    exit 1
fi

# Loop through creating PRs
for i in $(seq 1 $count); do
    branch_name="${name}_${i}"

    # Create branch and PR
    git checkout -b "${branch_name}"
    echo "${branch_name}" > "${branch_name}.txt"
    git add "${branch_name}.txt"
    git commit -m "${branch_name}"
    git push -u origin "${branch_name}"
    gh pr create -t "${branch_name}" -b ''
    git checkout main

    echo "Created PR for ${branch_name}"
done
